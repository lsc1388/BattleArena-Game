# BattleArena Game ‚Äî AI Coding Agent Guide<!-- BattleArena Game ‚Äî AI Coding Agent Guide --><!-- BattleArena Game ‚Äî AI Coding Agent Guide -->

Essential knowledge for AI coding agents to be immediately productive in this codebase. Focuses on architecture patterns, critical integration points, and project-specific conventions.Essential knowledge for AI coding agents to be immediately productive in this codebase. Focuses on architecture patterns, critical integration points, and project-specific conventions.Essential knowledge for AI coding agents to be immediately productive in this codebase. Focuses on archite**Quick Reference Examples**

## üèóÔ∏è Architecture Overview## üèóÔ∏è Architecture Overview**Config Access**: `weapon_data = WEAPON_CONFIGS[self.current_weapon]`

**Project**: Pygame 2D shooting game with character selection, multiple weapons, and AI opponents.**Message Display**: `self.game_ui.add_message("ÂΩàËó•‰∏çË∂≥", "warning", COLORS["yellow"])`

**Entry Point**: `main.py` ‚Üí `BattleArenaGame` class manages game loop and state machine:**Project**: Pygame 2D shooting game with character selection, multiple weapons, and AI opponents.**Character Skills**: Defined in `CHARACTER_CONFIGS[type]["skill"]` with damage, cooldown, effect_color

- State flow: menu ‚Üí character_select ‚Üí scene_select ‚Üí playing ‚Üí game_over

- Core pattern: Event handling ‚Üí Update logic ‚Üí Render ‚Üí Repeat at 60 FPS**Scene Backgrounds**: `SCENE_CONFIGS[scene]["background_color"]` for environment customization

**Module Structure**:**Entry Point**: `main.py` ‚Üí `BattleArenaGame` class manages game loop and state machine:

- `src/entities/`: Game objects (Player, Enemy, Bullet, PowerUp) - each implements `update()`, `get_rect()`, `draw()`, `is_alive`

- `src/systems/`: Service boundaries (CollisionSystem centralizes all collision detection)## üéØ Critical Project-Specific Patterns

- `src/ui/`: Interface layers (GameUI, SelectionUI) with Chinese font support via font_manager

- `src/utils/`: Shared utilities (FontManager singleton for Chinese text rendering)- State flow: menu ‚Üí character_select ‚Üí scene_select ‚Üí playing ‚Üí game_over

- `src/config.py`: **All configuration data** - never hardcode game values

- Core pattern: Event handling ‚Üí Update logic ‚Üí Render ‚Üí Repeat at 60 FPS**State Machine Flow**: Menu ‚Üí character_select ‚Üí scene_select ‚Üí playing ‚Üí game_over (see `main.py:BattleArenaGame`)

## üîí Critical Integration Points (DO NOT MODIFY ARBITRARILY)

**Module Structure**:**Skill System**: 3-second duration skills with visual effects and health cost - use `Player.use_skill()` and check `Player.is_skill_active()`

**Font Management**: Always use `font_manager.render_text(text, size, color)` or `font_manager.get_font(size)`:

```python- `src/entities/`: Game objects (Player, Enemy, Bullet, PowerUp) - each implements `update()`, `get_rect()`, `draw()`, `is_alive`**Level Progression**: Automatic enemy type switching between levels, track `level_enemies_killed`vs`LEVEL_CONFIGS[level]["enemy_count"]`

from src.utils.font_manager import font_manager

surface = font_manager.render_text("ÈÅäÊà≤ÊñáÂ≠ó", "medium", COLORS["white"])- `src/systems/`: Service boundaries (CollisionSystem centralizes all collision detection)

`````

- `src/ui/`: Interface layers (GameUI, SelectionUI) with Chinese font support via font_manager**Chinese Font Handling**: FontManager automatically detects system fonts, use `font_manager.render_text()` consistently

**Collision System**: All interactions handled by `CollisionSystem.check_all_collisions()`. Never implement custom collision loops:

```python- `src/utils/`: Shared utilities (FontManager singleton for Chinese text rendering)

collision_results = self.collision_system.check_all_collisions(

    self.player, self.enemies, self.bullet_manager, self.powerup_manager- `src/config.py`: **All configuration data** - never hardcode game values**AI Difficulty Scaling**: All AI properties in `AI_CONFIGS` affect enemy accuracy, health, and behavior patternspatterns, critical integration points, and project-specific conventions.

)

```## üîí Critical Integration Points (DO NOT MODIFY ARBITRARILY)## üèóÔ∏è Architecture Overview



**Configuration-Driven Design**: All balance values live in `src/config.py`:**Font Management**: Always use `font_manager.render_text(text, size, color)` or `font_manager.get_font(size)`:**Project**: Pygame 2D shooting game with character selection, multiple weapons, and AI opponents.

- `WEAPON_CONFIGS`: damage, ammo, reload times, fire_rate, special properties (spread, bullet_count)

- `CHARACTER_CONFIGS`: skills, colors, cooldowns, attributes (attack_power, fire_rate, speed, health multipliers)```python**Entry Point**: `main.py`‚Üí`BattleArenaGame` class manages game loop and state machine:

- `AI_CONFIGS`: difficulty levels, accuracy, behavior patterns, health

- `POWERUP_EFFECTS`: duration, multipliers, instant effects, weapon unlocksfrom src.utils.font_manager import font_manager

- `LEVEL_CONFIGS`: enemy types, counts, descriptions, completion messages

- `SCENE_CONFIGS`: background colors, accent colors, descriptionssurface = font_manager.render_text("ÈÅäÊà≤ÊñáÂ≠ó", "medium", COLORS["white"])- State flow: menu ‚Üí character_select ‚Üí scene_select ‚Üí playing ‚Üí game_over

- `AI_ENEMY_TYPES`: health, speed/accuracy modifiers, damage, attack frequency

````- Core pattern: Event handling ‚Üí Update logic ‚Üí Render ‚Üí Repeat at 60 FPS

## üéØ Entity System Patterns



**Standard Entity Interface**:

```python**Collision System**: All interactions handled by `CollisionSystem.check_all_collisions()`. Never implement custom collision loops:**Module Structure**:

def update(self, screen_width, screen_height):

    # Position updates and boundary checks



def get_rect(self):```python- `src/entities/`: Game objects (Player, Enemy, Bullet, PowerUp) - each implements `update()`, `get_rect()`, `draw()`, `is_alive`

    return pygame.Rect(self.x, self.y, self.width, self.height)

collision_results = self.collision_system.check_all_collisions(- `src/systems/`: Service boundaries (CollisionSystem centralizes all collision detection)

def draw(self, screen):

    # Render entity with character-specific colors/emojis    self.player, self.enemies, self.bullet_manager, self.powerup_manager- `src/ui/`: Interface layers (GameUI, SelectionUI) with Chinese font support via font_manager



# Health management (entities with health))- `src/utils/`: Shared utilities (FontManager singleton for Chinese text rendering)

self.health = initial_value

self.is_alive = self.health > 0```- `src/config.py`: **All configuration data** - never hardcode game values



# State management (all entities)

self.is_active = True  # For bullets, powerups

```**Configuration-Driven Design**: All balance values live in `src/config.py`:## üîí Critical Integration Points (DO NOT MODIFY ARBITRARILY)



**Manager Pattern for Collections**:

```python

# BulletManager handles all bullet lifecycle- `WEAPON_CONFIGS`: damage, ammo, reload times, fire_rate, special properties (spread, bullet_count)**Font Management**: Always use `font_manager.render_text(text, size, color)` or `font_manager.get_font(size)`:

self.bullet_manager.create_bullet(x, y, angle, speed, damage, owner)

self.bullet_manager.update(screen_width, screen_height)- `CHARACTER_CONFIGS`: skills, colors, cooldowns, attributes (attack_power, fire_rate, speed, health multipliers)

self.bullet_manager.draw(screen)

- `AI_ENEMY_TYPES`: health, speed/accuracy modifiers, damage, attack frequency (zombie‚Üíalien progression)```python

# PowerUpManager handles spawning and pickup logic

self.powerup_manager.spawn_powerup_on_enemy_death(x, y)- `POWERUP_EFFECTS`: duration, multipliers, instant effects, weapon unlocksfrom src.utils.font_manager import font_manager

`````

- `LEVEL_CONFIGS`: enemy types, counts, descriptions, completion messagessurface = font_manager.render_text("ÈÅäÊà≤ÊñáÂ≠ó", "medium", COLORS["white"])

**Safe Entity Removal Pattern**:

`` python- `SCENE_CONFIGS`: background colors, accent colors, descriptions ``

for entity in entities[:]: # Create copy for safe iteration

    if not entity.is_alive:

        entities.remove(entity)

```## üéØ Entity System Patterns**Collision System**: All interactions handled by `CollisionSystem.check_all_collisions()`. Never implement custom collision loops:

## üéØ Critical Project-Specific Patterns

**State Machine Flow**: Menu ‚Üí character_select ‚Üí scene_select ‚Üí playing ‚Üí game_over (see `main.py:BattleArenaGame`)**Standard Entity Interface**:```python

**Skill System**: 3-second duration skills with visual effects and health cost - use `Player.use_skill()` and check `Player.is_skill_active()`collision_results = self.collision_system.check_all_collisions(

**Level Progression**: Automatic enemy type switching between levels, track `level_enemies_killed` vs `LEVEL_CONFIGS[level]["enemy_count"]````python self.player, self.enemies, self.bullet_manager, self.powerup_manager

**Chinese Font Handling**: FontManager automatically detects system fonts, use `font_manager.render_text()` consistentlydef update(self, screen_width, screen_height):)

**AI Difficulty Scaling**: All AI properties in `AI_CONFIGS` affect enemy accuracy, health, and behavior patterns # Position updates and boundary checks```

## üéÆ Quick Reference Examples

**Config Access**: `weapon_data = WEAPON_CONFIGS[self.current_weapon]`def get_rect(self):**Configuration-Driven Design**: All balance values live in `src/config.py`:

**Message Display**: `self.game_ui.add_message("ÂΩàËó•‰∏çË∂≥", "warning", COLORS["yellow"])` return pygame.Rect(self.x, self.y, self.width, self.height)

**Character Skills**: Defined in `CHARACTER_CONFIGS[type]["skill"]` with damage, cooldown, effect_color- `WEAPON_CONFIGS`: damage, ammo, reload times, fire_rate, special properties (spread, bullet_count)

**Scene Backgrounds**: `SCENE_CONFIGS[scene]["background_color"]` for environment customizationdef draw(self, screen):- `CHARACTER_CONFIGS`: skills, colors, cooldowns, attributes (attack_power, fire_rate, speed, health multipliers)

## üõ†Ô∏è Development Workflow # Render entity with character-specific colors/emojis- `AI_CONFIGS`: difficulty levels, accuracy, behavior patterns, health

**Run Game**: `python main.py` (direct execution, no `if __name__ == "__main__":` needed)- `POWERUP_EFFECTS`: duration, multipliers, instant effects, weapon unlocks

**Run Tests**: `pytest -q` or `pytest tests/` (uses pytest framework)# Health management (entities with health)- `LEVEL_CONFIGS`: enemy types, counts, descriptions, completion messages

**Debug Keys**: F1 (spawn boss), F2 (complete level) for testingself.health = initial_value- `SCENE_CONFIGS`: background colors, accent colors, descriptions

## üìã Code Style Requirementsself.is_alive = self.health > 0- `AI_ENEMY_TYPES`: health, speed/accuracy modifiers, damage, attack frequency

**Naming**: snake_case (variables/functions), PascalCase (classes), SCREAMING_SNAKE_CASE (constants)

**Comments**: Use Chinese docstrings for public methods, `######################` for section separators# State management (all entities)## üéØ Entity System Patterns

**Imports**: Group by standard/third-party/local, use absolute imports from `src/`self.is_active = True # For bullets, powerups

## ‚ö†Ô∏è Common Pitfalls to Avoid```**Standard Entity Interface**:

- Never hardcode values - use `src/config.py` configurations

- Always use `font_manager` for text rendering (handles Chinese fonts)

- Don't implement custom collision detection - use `CollisionSystem`**Manager Pattern for Collections**:```python

- Use manager classes for bullets/powerups, not direct entity lists

- Remember safe iteration patterns when removing entitiesdef update(self, screen_width, screen_height):

- Character attributes are multipliers applied to base values, not absolute values

````python # Position updates and boundary checks

# BulletManager handles all bullet lifecycle

self.bullet_manager.create_bullet(x, y, angle, speed, damage, owner)def get_rect(self):

self.bullet_manager.update(screen_width, screen_height)    return pygame.Rect(self.x, self.y, self.width, self.height)

self.bullet_manager.draw(screen)

def draw(self, screen):

# PowerUpManager handles spawning and pickup logic    # Render entity with character-specific colors/emojis

self.powerup_manager.spawn_powerup_on_enemy_death(x, y)

```# Health management (entities with health)

self.health = initial_value

**Safe Entity Removal Pattern**:self.is_alive = self.health > 0



```python# State management (all entities)

for entity in entities[:]:  # Create copy for safe iterationself.is_active = True  # For bullets, powerups

    if not entity.is_alive:```

        ---
        applyTo: "**"
        ---

        # BattleArena ‚Äî Copilot ÊåáÂºïÔºàÁ∞°ÊΩîÁâàÔºâ

        ‰ª•‰∏ãÊåáÂºïÁÇ∫ËÆì AI Á∑®Á¢º‰ª£ÁêÜËÉΩÂø´ÈÄüÂú®Ê≠§Â∞àÊ°à‰∏≠Â∑•‰ΩúÊâÄÈúÄÁöÑÈóúÈçµÁü•Ë≠òÔºöÂ∞àÊ°àÊû∂Êßã„ÄÅÈáçË¶ÅÊï¥ÂêàÈªû„ÄÅÂ∏∏Áî®Á®ãÂºèÁ¢ºÊ®°ÂºèËàáÈñãÁôºÊµÅÁ®ã„ÄÇ

        1. ÂÖ•Âè£ËàáÊï¥È´îÊû∂Êßã
            - ÂÖ•Âè£Ôºö`main.py`ÔºåÊ†∏ÂøÉÈ°ûÂà• `BattleArenaGame` ÁÆ°ÁêÜÁãÄÊÖãÊ©üÔºàmenu ‚Üí character_select ‚Üí scene_select ‚Üí playing ‚Üí game_overÔºâ„ÄÇ
            - Ê®°ÁµÑÂäÉÂàÜÔºö`src/entities/`ÔºàPlayer„ÄÅEnemy„ÄÅBullet„ÄÅPowerUpÔºâ„ÄÅ`src/systems/`ÔºàCollisionSystemÔºâ„ÄÅ`src/ui/`ÔºàGameUI, SelectionUIÔºâ„ÄÅ`src/utils/`Ôºàfont_managerÔºâ„ÄÅ`src/config.py`ÔºàÊâÄÊúâÈÅäÊà≤Êï∏ÂÄºËàáË®≠ÂÆöÔºâ„ÄÇ

        2. ÈóúÈçµÁ¥ÑÂÆöËàáÊ®°Âºè
            - ÈÖçÁΩÆÈ©ÖÂãïÔºöÊâÄÊúâÈÅäÊà≤ÂèÉÊï∏Ôºàweapon„ÄÅlevel„ÄÅAIÔºâÈõÜ‰∏≠Âú® `src/config.py`ÔºåË´ãÂãøÁ°¨Á∑®Á¢ºÊï∏ÂÄº„ÄÇ
            - ÂØ¶È´î‰ªãÈù¢ÔºöÊØèÂÄã entity ÂØ¶‰Ωú `update(screen_w, screen_h)`, `get_rect()`, `draw(screen)`, `is_alive`„ÄÇ
            - ÁÆ°ÁêÜÂô®Ê®°ÂºèÔºöBullet/PowerUp Êúâ manager È°ûÂà•Ë≤†Ë≤¨Âª∫Á´ã„ÄÅÊõ¥Êñ∞ËàáÊ∏ÖÁêÜÔºàsafe removal: iterate over copy `for e in entities[:]`Ôºâ„ÄÇ
            - Á¢∞ÊíûÔºöÊâÄÊúâ‰∫§‰∫íË´ãÈÄèÈÅé `CollisionSystem.check_all_collisions()`Ôºå‰∏çË¶ÅÂØ´Ëá™Ë®ÇÁ¢∞ÊíûËø¥Âúà„ÄÇ

        3. UI / Â≠óÂûã
            - ÊñáÂ≠óË´ã‰ΩøÁî® `font_manager.render_text(text, size, color)` Êàñ `font_manager.get_font(size)`ÔºåÂ∞àÊ°à‰ª•ÁπÅÈ´î‰∏≠ÊñáÁÇ∫‰∏ª„ÄÇ
            - Âø´ÈÄüË®äÊÅØÔºöÁî® `game_ui.add_message(text, type, color)` È°ØÁ§∫Ëá®ÊôÇÈÄöÁü•„ÄÇ

        4. ÊéßÂà∂ËàáËº∏ÂÖ•ÁøíÊÖ£
            - ÈÄ£Á∫åËº∏ÂÖ•Ëàá‰∫ã‰ª∂ÂàÜÈõ¢Ôºö‰ΩøÁî® `_handle_continuous_input()` ËôïÁêÜ WASD ËàáÊªëÈº†ÊåÅÁ∫åÊìç‰ΩúÔºå‰∫ã‰ª∂ËôïÁêÜÁî®‰∏ÄËà¨‰∫ã‰ª∂ÂõûÂëº„ÄÇ
            - ÈáçË¶ÅÊåâÈçµÔºöWASDÔºàÁßªÂãïÔºâ„ÄÅÊªëÈº†Â∑¶ÈçµÔºàÂ∞ÑÊìäÔºâ„ÄÅ1-5ÔºàÊ≠¶Âô®ÂàáÊèõÔºâ„ÄÅQÔºàÊäÄËÉΩÔºâ„ÄÅRÔºàÈáçË£ùÔºâ„ÄÅCÔºàÂàáÊèõÊ∫ñÊòüÔºâ„ÄÅESCÔºàËøîÂõûÈÅ∏ÂñÆÔºâ„ÄÇ

        5. Êñ∞Â¢û/ËÆäÊõ¥Ë¶ÅÈªûÔºàÁØÑ‰æãÔºâ
            - Êñ∞Ê≠¶Âô®ÔºöÂú® `WEAPON_CONFIGS` Êñ∞Â¢ûË®≠ÂÆöÔºå‰∏¶Á¢∫Ë™ç `Player.handle_weapon_switch()` ÊîØÊè¥Ë©≤Èçµ‰ΩçËàá ammo/reload Ë°åÁÇ∫„ÄÇ
            - Êñ∞Êïµ‰∫∫ÔºöÂú® `AI_ENEMY_TYPES` Âä†ÂÖ•‰∏¶Âú® `BattleArenaGame._spawn_enemy()` Â∞çÊáâ spawnÔºõÊ∏¨Ë©¶ `Enemy.update()` Ë°åÁÇ∫„ÄÇ
            - Êñ∞ power-upÔºöÂú® `POWERUP_EFFECTS` ÂÆöÁæ©ÔºåÂØ¶‰Ωú `PowerUp.apply_effect()` ‰∏¶ËÆì `Player.update_powerups()` ËôïÁêÜÊïàÊûú„ÄÇ

        6. ÈñãÁôº / Âü∑Ë°å / Ê∏¨Ë©¶
            - Âü∑Ë°åÈÅäÊà≤ÔºöÂú®Â∞àÊ°àÊ†πÁõÆÈåÑÂü∑Ë°å `python main.py`ÔºàÂ∞àÊ°àÂú® main.py Áõ¥Êé•ÂëºÂè´ game loopÔºâ„ÄÇ
            - ÂñÆÂÖÉÊ∏¨Ë©¶ÔºöÂ∞àÊ°à‰ΩøÁî® pytestÔºàÊ™¢Ë¶ñ `tests/`ÔºâÔºåÂú®‰øÆÊîπÂæåË´ãÂü∑Ë°å `pytest -q` È©óË≠â„ÄÇËã• CI Â≠òÂú®ÔºåÈÅµÂæ™ÂÖ∂Áí∞Â¢ÉËÆäÊï∏Ëàá Python ÁâàÊú¨„ÄÇ

        7. È¢®Ê†ºËàáÊ†ºÂºèÔºàÂèØË¢´ agent Ëá™ÂãïÈÅµÂÆàÔºâ
            - ÂëΩÂêçÔºösnake_caseÔºàËÆäÊï∏/ÂáΩÂºèÔºâ„ÄÅPascalCaseÔºàÈ°ûÂà•Ôºâ„ÄÅSCREAMING_SNAKE_CASEÔºàÂ∏∏Êï∏Ôºâ„ÄÇ
            - Ë®ªËß£ÔºöÂÖ¨ÈñãÊñπÊ≥ïÈúÄÁπÅÈ´î‰∏≠Êñá docstringÔºõ‰ΩøÁî® `######################` ‰ΩúÂçÄÂ°äÂàÜÈöî„ÄÇ

        8. ‰∏çÂèØ‰ªªÊÑè‰øÆÊîπÁöÑÊï¥ÂêàÈªû
            - `src/config.py`ÔºöÂπ≥Ë°°ËàáÂèÉÊï∏‰æÜÊ∫ê„ÄÇ
            - `CollisionSystem`ÔºöÈõÜ‰∏≠Á¢∞ÊíûÈÇèËºØÔºåÈÅøÂÖçÂàÜÊï£ÂØ¶‰Ωú„ÄÇ
            - `font_manager`ÔºöÁµ±‰∏ÄÊñáÂ≠óÊ∏≤ÊüìËàáÂ≠óÂûãÂø´Âèñ„ÄÇ

        9. Êé¢Á¥¢Âø´ÈÄüÂèÉËÄÉÔºàÈóúÈçµÊ™îÊ°àÔºâ
            - `main.py`ÔºàÂÖ•Âè£„ÄÅÁãÄÊÖãÊ©üÔºâ
            - `src/config.py`ÔºàÊâÄÊúâË®≠ÂÆöÔºâ
            - `src/systems/collision.py`ÔºàÁ¢∞ÊíûÂåØÊµÅËôïÔºâ
            - `src/utils/font_manager.py`ÔºàÂ≠óÂûãÊ∏≤ÊüìÔºâ
            - `src/entities/`ÔºàPlayer, Enemy, Bullet, PowerUpÔºâ

        10. ËÆäÊõ¥Á¥ÄÈåÑËàáÂõûÈ•ã
            - Ëã•‰Ω†ÁúãÂà∞ÂäüËÉΩÊÄßË°ùÁ™ÅÊàñÈúÄË¶ÅÊñ∞Â¢û CI Êåá‰ª§ÔºåË´ãÂõûÂ†±‰∏¶Êèê‰æõÊúÄÂ∞èÂèØÈáçÁèæÊ≠•È©ü„ÄÇ

        ---
        Ë´ãÂØ©Èñ±ÈÄô‰ªΩÁ∞°ÊΩîÊåáÂºïÔºåÂëäË®¥ÊàëÊòØÂê¶Ë¶ÅÊääÊüê‰∫õÁ¥∞ÁØÄÊì¥ÂÖÖÁÇ∫ÁØÑ‰æãÁâáÊÆµÔºà‰æãÂ¶Ç `CollisionSystem.check_all_collisions()` ÁöÑ‰ΩøÁî®ÊñπÂºèÊàñ `WEAPON_CONFIGS` ÁØÑ‰æãÔºâ„ÄÇ
**Skill System**: 3-second duration skills with visual effects and health cost - use `Player.use_skill()` and check `Player.is_skill_active()`
````
